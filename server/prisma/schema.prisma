// server/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- ENUMS (Opciones fijas) ---
enum Role {
  ADMIN
  COCINA
  GARZON
}

enum EstadoPedido {
  PENDIENTE
  EN_PREPARACION
  LISTO
  RETIRADO    
  ENTREGADO   
  PAGADO      
}

// --- MODELOS ---

model Usuario {
  id        Int      @id @default(autoincrement())
  nombre    String
  email     String   @unique
  password  String
  rol       Role
  activo    Boolean  @default(true)
  createdAt DateTime @default(now())

  // Relaciones
  pedidos   Pedido[]
  turnos    Turno[]
  mesas     Mesa[]
}

model Turno {
  id          Int       @id @default(autoincrement())
  fechaInicio DateTime  @default(now())
  fechaFin    DateTime?
  totalVentas Float     @default(0)
  
  usuarioId   Int
  usuario     Usuario   @relation(fields: [usuarioId], references: [id])
  pedidos     Pedido[]
}

model Mesa {
  id        Int      @id @default(autoincrement())
  numero    String   @unique
  capacidad Int
  estado    String   @default("libre") // libre, ocupada, por_pagar

  // NUEVO: Relación con el Garzón que la atiende actualmente
  usuarioId Int?      
  usuario   Usuario?  @relation(fields: [usuarioId], references: [id])

  pedidos   Pedido[]
}

model Producto {
  id          Int     @id @default(autoincrement())
  nombre      String
  precio      Float
  categoria   String  // bebida, plato, postre
  estacion    String  // barra, cocina_fria, cocina_caliente
  disponible  Boolean @default(true)

  detalles    DetallePedido[]
}

model Pedido {
  id            Int           @id @default(autoincrement())
  fechaCreacion DateTime      @default(now())
  fechaTermino  DateTime?     
  estado        EstadoPedido  @default(PENDIENTE)
  total         Float         @default(0)
  notas         String?
  
  mesaId        Int
  mesa          Mesa          @relation(fields: [mesaId], references: [id])
  
  usuarioId     Int
  usuario       Usuario       @relation(fields: [usuarioId], references: [id])
  
  turnoId       Int?
  turno         Turno?        @relation(fields: [turnoId], references: [id])
  
  detalles      DetallePedido[]
}

model DetallePedido {
  id          Int      @id @default(autoincrement())
  cantidad    Int
  precioUnit  Float
  
  // NUEVO: Estado individual por plato/bebida
  estado      EstadoPedido @default(PENDIENTE) 

  pedidoId    Int
  pedido      Pedido   @relation(fields: [pedidoId], references: [id])
  productoId  Int
  producto    Producto @relation(fields: [productoId], references: [id])
}